log_prob batches:   0%|          | 0/63 [00:00<?, ?it/s]log_prob batches:   2%|▏         | 1/63 [00:04<04:08,  4.00s/it]log_prob batches:   3%|▎         | 2/63 [00:04<01:48,  1.77s/it]log_prob batches:   5%|▍         | 3/63 [00:05<01:22,  1.38s/it]log_prob batches:   6%|▋         | 4/63 [00:05<00:56,  1.05it/s]log_prob batches:   8%|▊         | 5/63 [00:05<00:40,  1.44it/s]log_prob batches:  10%|▉         | 6/63 [00:05<00:31,  1.82it/s]log_prob batches:  11%|█         | 7/63 [00:06<00:27,  2.05it/s]log_prob batches:  13%|█▎        | 8/63 [00:06<00:21,  2.58it/s]log_prob batches:  14%|█▍        | 9/63 [00:06<00:21,  2.53it/s]log_prob batches:  16%|█▌        | 10/63 [00:07<00:17,  3.05it/s]log_prob batches:  17%|█▋        | 11/63 [00:07<00:16,  3.14it/s]log_prob batches:  19%|█▉        | 12/63 [00:07<00:15,  3.29it/s]log_prob batches:  21%|██        | 13/63 [00:07<00:14,  3.57it/s]log_prob batches:  22%|██▏       | 14/63 [00:08<00:16,  2.98it/s]log_prob batches:  24%|██▍       | 15/63 [00:08<00:15,  3.19it/s]log_prob batches:  25%|██▌       | 16/63 [00:08<00:14,  3.31it/s]log_prob batches:  27%|██▋       | 17/63 [00:09<00:13,  3.53it/s]log_prob batches:  29%|██▊       | 18/63 [00:09<00:19,  2.34it/s]log_prob batches:  30%|███       | 19/63 [00:10<00:17,  2.45it/s]log_prob batches:  32%|███▏      | 20/63 [00:10<00:14,  2.88it/s]log_prob batches:  33%|███▎      | 21/63 [00:10<00:12,  3.24it/s]log_prob batches:  35%|███▍      | 22/63 [00:10<00:11,  3.62it/s]log_prob batches:  37%|███▋      | 23/63 [00:10<00:09,  4.16it/s]log_prob batches:  38%|███▊      | 24/63 [00:11<00:08,  4.44it/s]log_prob batches:  40%|███▉      | 25/63 [00:11<00:08,  4.51it/s]log_prob batches:  41%|████▏     | 26/63 [00:11<00:09,  3.97it/s]log_prob batches:  43%|████▎     | 27/63 [00:11<00:08,  4.34it/s]log_prob batches:  44%|████▍     | 28/63 [00:12<00:08,  4.19it/s]log_prob batches:  46%|████▌     | 29/63 [00:12<00:10,  3.29it/s]log_prob batches:  48%|████▊     | 30/63 [00:12<00:09,  3.49it/s]log_prob batches:  49%|████▉     | 31/63 [00:13<00:08,  3.80it/s]log_prob batches:  51%|█████     | 32/63 [00:13<00:08,  3.57it/s]log_prob batches:  52%|█████▏    | 33/63 [00:13<00:07,  3.82it/s]log_prob batches:  54%|█████▍    | 34/63 [00:13<00:07,  4.08it/s]log_prob batches:  56%|█████▌    | 35/63 [00:14<00:06,  4.27it/s]log_prob batches:  57%|█████▋    | 36/63 [00:14<00:06,  4.45it/s]log_prob batches:  59%|█████▊    | 37/63 [00:14<00:05,  4.65it/s]log_prob batches:  60%|██████    | 38/63 [00:14<00:07,  3.30it/s]log_prob batches:  62%|██████▏   | 39/63 [00:15<00:06,  3.66it/s]log_prob batches:  63%|██████▎   | 40/63 [00:17<00:18,  1.25it/s]log_prob batches:  65%|██████▌   | 41/63 [00:17<00:16,  1.36it/s]log_prob batches:  67%|██████▋   | 42/63 [00:18<00:12,  1.66it/s]log_prob batches:  68%|██████▊   | 43/63 [00:18<00:09,  2.09it/s]log_prob batches:  70%|██████▉   | 44/63 [00:18<00:07,  2.54it/s]log_prob batches:  71%|███████▏  | 45/63 [00:18<00:05,  3.04it/s]log_prob batches:  73%|███████▎  | 46/63 [00:18<00:04,  3.50it/s]log_prob batches:  75%|███████▍  | 47/63 [00:19<00:04,  3.54it/s]log_prob batches:  76%|███████▌  | 48/63 [00:19<00:03,  3.77it/s]log_prob batches:  78%|███████▊  | 49/63 [00:19<00:04,  2.92it/s]log_prob batches:  79%|███████▉  | 50/63 [00:20<00:03,  3.35it/s]log_prob batches:  81%|████████  | 51/63 [00:20<00:03,  3.62it/s]log_prob batches:  83%|████████▎ | 52/63 [00:20<00:02,  4.02it/s]log_prob batches:  84%|████████▍ | 53/63 [00:20<00:02,  4.13it/s]log_prob batches:  86%|████████▌ | 54/63 [00:20<00:02,  4.44it/s]log_prob batches:  87%|████████▋ | 55/63 [00:21<00:01,  4.42it/s]log_prob batches:  89%|████████▉ | 56/63 [00:21<00:01,  4.03it/s]log_prob batches:  90%|█████████ | 57/63 [00:21<00:01,  4.26it/s]log_prob batches:  92%|█████████▏| 58/63 [00:21<00:01,  4.17it/s]log_prob batches:  94%|█████████▎| 59/63 [00:22<00:01,  2.65it/s]log_prob batches:  95%|█████████▌| 60/63 [00:23<00:01,  1.90it/s]log_prob batches:  97%|█████████▋| 61/63 [00:23<00:01,  1.99it/s]log_prob batches:  98%|█████████▊| 62/63 [00:24<00:00,  2.32it/s]log_prob batches: 100%|██████████| 63/63 [00:24<00:00,  2.61it/s]
log_prob batches:   0%|          | 0/63 [00:00<?, ?it/s]log_prob batches:   2%|▏         | 1/63 [00:00<00:11,  5.43it/s]log_prob batches:   3%|▎         | 2/63 [00:00<00:10,  5.60it/s]log_prob batches:   5%|▍         | 3/63 [00:01<00:30,  1.96it/s]log_prob batches:   6%|▋         | 4/63 [00:01<00:23,  2.46it/s]log_prob batches:   8%|▊         | 5/63 [00:01<00:19,  3.03it/s]log_prob batches:  10%|▉         | 6/63 [00:01<00:17,  3.24it/s]log_prob batches:  11%|█         | 7/63 [00:02<00:17,  3.22it/s]log_prob batches:  13%|█▎        | 8/63 [00:02<00:14,  3.68it/s]log_prob batches:  14%|█▍        | 9/63 [00:02<00:15,  3.44it/s]log_prob batches:  16%|█▌        | 10/63 [00:02<00:13,  3.90it/s]log_prob batches:  17%|█▋        | 11/63 [00:03<00:13,  3.77it/s]log_prob batches:  19%|█▉        | 12/63 [00:03<00:12,  4.13it/s]log_prob batches:  21%|██        | 13/63 [00:03<00:11,  4.32it/s]log_prob batches:  22%|██▏       | 14/63 [00:04<00:14,  3.29it/s]log_prob batches:  24%|██▍       | 15/63 [00:04<00:13,  3.68it/s]log_prob batches:  25%|██▌       | 16/63 [00:04<00:12,  3.66it/s]log_prob batches:  27%|██▋       | 17/63 [00:04<00:11,  3.87it/s]log_prob batches:  29%|██▊       | 18/63 [00:05<00:18,  2.45it/s]log_prob batches:  30%|███       | 19/63 [00:05<00:16,  2.63it/s]log_prob batches:  32%|███▏      | 20/63 [00:06<00:14,  3.06it/s]log_prob batches:  33%|███▎      | 21/63 [00:06<00:11,  3.56it/s]log_prob batches:  35%|███▍      | 22/63 [00:06<00:10,  3.97it/s]log_prob batches:  37%|███▋      | 23/63 [00:06<00:08,  4.69it/s]log_prob batches:  38%|███▊      | 24/63 [00:06<00:07,  4.88it/s]log_prob batches:  40%|███▉      | 25/63 [00:06<00:07,  4.79it/s]log_prob batches:  41%|████▏     | 26/63 [00:07<00:09,  3.91it/s]log_prob batches:  43%|████▎     | 27/63 [00:07<00:08,  4.32it/s]log_prob batches:  44%|████▍     | 28/63 [00:07<00:08,  4.26it/s]log_prob batches:  46%|████▌     | 29/63 [00:08<00:09,  3.61it/s]log_prob batches:  48%|████▊     | 30/63 [00:08<00:08,  3.75it/s]log_prob batches:  49%|████▉     | 31/63 [00:08<00:07,  4.18it/s]log_prob batches:  51%|█████     | 32/63 [00:08<00:07,  3.91it/s]log_prob batches:  52%|█████▏    | 33/63 [00:09<00:07,  4.25it/s]log_prob batches:  54%|█████▍    | 34/63 [00:09<00:06,  4.43it/s]log_prob batches:  56%|█████▌    | 35/63 [00:09<00:05,  4.68it/s]log_prob batches:  57%|█████▋    | 36/63 [00:09<00:05,  4.76it/s]log_prob batches:  59%|█████▊    | 37/63 [00:09<00:05,  4.90it/s]log_prob batches:  60%|██████    | 38/63 [00:10<00:07,  3.45it/s]log_prob batches:  62%|██████▏   | 39/63 [00:10<00:06,  3.91it/s]log_prob batches:  62%|██████▏   | 39/63 [00:12<00:07,  3.01it/s]
Traceback (most recent call last):
  File "/mmfs1/gscratch/ark/devinl6/preference/preference-decoding/utils/eval_approx.py", line 63, in <module>
    accuracy = get_approximation_accuracy(
  File "/mmfs1/gscratch/ark/devinl6/preference/preference-decoding/utils/drift.py", line 355, in get_approximation_accuracy
    yl_base_probs, _ = log_prob(model_ds, yl_list, [base_prompt] * n, questions, device, tokenizer, batch_size=batch_size)
  File "/mmfs1/gscratch/ark/devinl6/preference/preference-decoding/utils/drift.py", line 61, in log_prob
    probs = torch.nn.functional.log_softmax(outputs, dim=-1)
  File "/gscratch/ark/devinl6/envs/align/lib/python3.10/site-packages/torch/nn/functional.py", line 2248, in log_softmax
    ret = input.log_softmax(dim)
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 14.40 GiB. GPU 0 has a total capacity of 44.42 GiB of which 12.07 GiB is free. Including non-PyTorch memory, this process has 32.34 GiB memory in use. Of the allocated memory 18.87 GiB is allocated by PyTorch, and 12.98 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
